<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Web Pedaleira Pro</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:Arial;
  color:white;
}

.pedal{
  width:360px;
  height:560px;
  background:#1c1c1c;
  border-radius:25px;
  box-shadow:0 0 40px #000;
  padding:20px;
  text-align:center;
  position:relative;
}

h2{
  color:#00ff88;
  margin:5px 0 15px;
}

.knob-container{
  display:inline-block;
  margin:12px;
}

.knob{
  width:65px;
  height:65px;
  border-radius:50%;
  background:linear-gradient(#333,#111);
  position:relative;
  cursor:pointer;
}

.knob::after{
  content:"";
  width:4px;
  height:22px;
  background:#00ff88;
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  border-radius:2px;
}

.label{
  margin-top:6px;
  font-size:13px;
}

select{
  margin-top:10px;
  padding:5px;
  background:#222;
  color:white;
  border:1px solid #444;
}

.footswitch{
  margin-top:20px;
  width:140px;
  height:55px;
  border-radius:15px;
  border:none;
  font-size:18px;
  cursor:pointer;
  transition:0.2s;
}

.off{ background:#333; color:white; }
.on{ background:#00ff88; color:black; box-shadow:0 0 20px #00ff88; }

.led{
  width:15px;
  height:15px;
  border-radius:50%;
  background:#300;
  margin:10px auto;
}

.led.active{
  background:red;
  box-shadow:0 0 15px red;
}

.footer{
  position:absolute;
  bottom:10px;
  width:100%;
  font-size:12px;
  color:#666;
}
</style>
</head>

<body>

<div class="pedal">
  <h2>ðŸ”¥ WEB PEDALEIRA PRO</h2>

  <div>
    <div class="knob-container"><div class="knob" data-control="drive"></div><div class="label">Drive</div></div>
    <div class="knob-container"><div class="knob" data-control="tone"></div><div class="label">Tone</div></div>
    <div class="knob-container"><div class="knob" data-control="level"></div><div class="label">Level</div></div>
  </div>

  <div>
    <div class="knob-container"><div class="knob" data-control="delay"></div><div class="label">Delay</div></div>
    <div class="knob-container"><div class="knob" data-control="reverb"></div><div class="label">Reverb</div></div>
    <div class="knob-container"><div class="knob" data-control="chorus"></div><div class="label">Chorus</div></div>
  </div>

  <select id="mode">
    <option value="blues">Blues</option>
    <option value="rock">Rock</option>
    <option value="metal">Metal</option>
  </select>

  <div class="led" id="led"></div>
  <button id="toggle" class="footswitch off">OFF</button>

  <div class="footer">Web Guitar Processor</div>
</div>

<script>
let audioCtx;
let input, distortion, toneFilter, gainNode;
let delayNode, delayGain;
let chorusDelay, chorusLFO, chorusDepth;
let isOn=false;

let values={
  drive:30,
  tone:1500,
  level:1,
  delay:0,
  reverb:0,
  chorus:0
};

function makeDistortionCurve(amount){
  const n=44100;
  const curve=new Float32Array(n);
  for(let i=0;i<n;i++){
    let x=i*2/n-1;
    curve[i]=(3+amount)*x/(Math.PI+amount*Math.abs(x));
  }
  return curve;
}

async function initAudio(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  input=audioCtx.createMediaStreamSource(stream);

  distortion=audioCtx.createWaveShaper();
  toneFilter=audioCtx.createBiquadFilter();
  gainNode=audioCtx.createGain();
  delayNode=audioCtx.createDelay(2);
  delayGain=audioCtx.createGain();

  // CHORUS
  chorusDelay=audioCtx.createDelay();
  chorusDelay.delayTime.value=0.02;
  chorusLFO=audioCtx.createOscillator();
  chorusDepth=audioCtx.createGain();
  chorusLFO.frequency.value=1.5;
  chorusDepth.gain.value=0;
  chorusLFO.connect(chorusDepth);
  chorusDepth.connect(chorusDelay.delayTime);
  chorusLFO.start();

  toneFilter.type="lowpass";

  input.connect(distortion);
  distortion.connect(toneFilter);

  toneFilter.connect(chorusDelay);
  chorusDelay.connect(delayNode);

  delayNode.connect(delayGain);
  delayGain.connect(gainNode);

  toneFilter.connect(gainNode); // sinal limpo
  gainNode.connect(audioCtx.destination);

  updateAudio();
}

function updateAudio(){
  distortion.curve=makeDistortionCurve(values.drive);
  toneFilter.frequency.value=values.tone;
  gainNode.gain.value=isOn?values.level:0;
  delayNode.delayTime.value=values.delay;
  delayGain.gain.value=values.delay;
  chorusDepth.gain.value=values.chorus*0.01;
}

function setMode(mode){
  if(mode==="blues"){ values.drive=20; values.tone=2000; }
  if(mode==="rock"){ values.drive=50; values.tone=1500; }
  if(mode==="metal"){ values.drive=90; values.tone=1000; }
  updateAudio();
}

document.getElementById("mode").onchange=e=>setMode(e.target.value);

document.getElementById("toggle").onclick=async()=>{
  if(!audioCtx) await initAudio();
  isOn=!isOn;
  document.getElementById("toggle").className="footswitch "+(isOn?"on":"off");
  document.getElementById("toggle").textContent=isOn?"ON":"OFF";
  document.getElementById("led").classList.toggle("active");
  updateAudio();
};

document.querySelectorAll(".knob").forEach(knob=>{
  let rotation=0;
  knob.onmousedown=e=>{
    document.onmousemove=ev=>{
      rotation+=ev.movementY*-2;
      rotation=Math.max(-135,Math.min(135,rotation));
      knob.style.transform=`rotate(${rotation}deg)`;
      let percent=(rotation+135)/270;
      let control=knob.dataset.control;

      if(control==="drive") values.drive=percent*100;
      if(control==="tone") values.tone=200+percent*4800;
      if(control==="level") values.level=percent*2;
      if(control==="delay") values.delay=percent*0.7;
      if(control==="reverb") values.reverb=percent;
      if(control==="chorus") values.chorus=percent*100;

      updateAudio();
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
});
</script>

</body>
</html>
